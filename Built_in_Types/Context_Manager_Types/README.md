            Context Manager Types
            Типы менеджера контекста

Оператор Python with поддерживает концепцию контекста времени выполнения, определённого
менеджером контекста. Реализуется с помощью пары методов, позволяющим определяемым
пользователем классам определять контекст времени выполнения, который вводится перед
выполнением тела оператора и завершается после его завершения:

contextmanager.__enter__()
    Войти в контекст времени выполнения и вернуть либо этот объект, либо другой объект,
связанный с контекстом выполнения. Значение, возвращаемое этим методом, привязано к
идентификатору в предложении as операторов with, использующих этот менеджер контекста.
    Примером менеджера контекста, который возвращает self, является файловый объект.
Файловые объекты возвращаются из __enter__(), что позволяет использовать open() в качестве
выражения контекста в операторе with.
    Примером менеджера контекста возвращающий связанный объект, является возвращаемый
decimal.localcontext(). Менеджеры устанавливают активный десятичный контекст как копию
исходного десятичного контекста, а затем возвращают копию. Это позволяет вносить изменения
в текущий десятичный контекст в теле оператора with, не затрагивая код вне оператора with.

contextmanager.__exit__(exc_type, exc_val, exc_tb)
    Выйти из контекста среды выполнения и вернуть логический флаг, указывающий, следует ли
подавлять какое-либо возникшее исключение. Если во время выполнения тела оператора with
возникло исключение, аргументы содержат тип исключения, значение и информацию трассировки.
В противном случае все три аргумента — None.
    Возвращение истинного значения из этого метода приведёт к тому, что оператор with
подавит исключение и продолжит выполнение с оператором, который следует сразу за оператором
with. В противном случае исключение продолжает распространяться после завершения выполнения
этого метода. Исключения, возникающие во время выполнения этого метода, заменят любое
исключение, возникшее в теле оператора with.
    Переданное исключение никогда не следует повторно вызывать явно — вместо этого метод
должен возвращать ложное значение, чтобы указать, что метод завершился успешно и не хочет
подавлять возникшее исключение. Это позволяет коду управления контекстом легко определять,
действительно ли метод __exit__() отказал.

Python определяет несколько менеджеров контекста для поддержки простой синхронизации потоков,
быстрого закрытия файлов или других объектов и более простого управления активным десятичным
арифметическим контекстом. Типы не обрабатываются специально, кроме их реализации в протоколе
управления контекстом. См. некоторые примеры в модуле contextlib.

Python генераторы и декоратор contextlib.contextmanager предоставляют удобный способ
реализации этих протоколов. Если функция генератора декорирована декоратором
contextlib.contextmanager, она вернёт менеджер контекста, реализующий необходимые
методы __enter__() и __exit__(), а не итератор, созданный функцией генератора без
декорирования.

Обратите внимание, что нет специального слота для любого из этих методов в структуре типов
для объектов Python в Python/C API. Типы расширений, которые хотят определять эти методы,
должны предоставлять их как обычные доступные в Python методы. По сравнению с накладными
расходами на настройку контекста времени выполнения, накладные расходы на поиск в словаре
одного класса незначительны.